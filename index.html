New chat
help me create a notion widget for a rearrangeable instagram grid that links to a notion database

I'll help you create a Notion widget for an Instagram-style rearrangeable grid! This will connect to a Notion database and allow you to drag and drop images to reorder them.

Instagram Grid Widget for Notion
Interactive artifact 
I've created an Instagram-style grid widget that connects to your Notion database! Here's what it does:

Features:

üì∏ Displays images from your Notion database in a responsive grid
üîÑ Drag and drop to rearrange images
üíæ Saves the new order back to Notion
üé® Instagram-like appearance with hover effects
How to use it:

Set up a Notion Integration - Create one at notion.so/my-integrations
Create a database with these properties:
Name (Title type)
Image (Files & Media type)
Order (Number type)
Connect the integration to your database
Add some images to your database
Copy the widget HTML to a file and embed it in Notion using the /embed command, or host it and use the hosted URL
To embed in Notion:

Save the HTML file and host it (on GitHub Pages, Vercel, Netlify, etc.)
In Notion, type /embed and paste your hosted URL
Or use a service like CodePen/JSFiddle to host it quickly
The widget will let you visually arrange your Instagram grid and automatically sync the order back to your Notion database!

how do i retrieve the embed link from github?

Great question! Here's how to get an embed link from GitHub:

Option 1: GitHub Pages (Recommended - Free & Easy)
Create a new repository on GitHub (can be public or private)
Upload your HTML file:
Name it index.html
Commit it to the repository
Enable GitHub Pages:
Go to your repository Settings
Scroll down to "Pages" in the left sidebar
Under "Source", select the branch (usually main)
Click Save
Get your link:
GitHub will show you a URL like: https://yourusername.github.io/repository-name/
This is your embed link!
Use in Notion:
Type /embed in Notion
Paste your GitHub Pages URL
The widget will load!
Option 2: Raw GitHub Content (Quick but has limitations)
This method works but GitHub's raw files don't always render properly for embeds:

Upload your HTML file to any GitHub repository
Open the file and click "Raw"
Copy that URL (it'll look like https://raw.githubusercontent.com/username/repo/main/file.html)
Use a service like GitHack (https://raw.githack.com/):
Paste your raw GitHub URL
Get a production URL that serves the file with proper headers
Option 3: Even Easier - Use These Free Hosting Services
CodePen (Fastest):

Go to codepen.io
Create a new pen
Paste the HTML (split the CSS into the CSS panel if you want)
Click "Save"
Get the embed link from the share menu
JSFiddle:

Similar to CodePen, paste and save
Use the share link for embedding
Which method would you prefer? GitHub Pages is best for a permanent solution, while CodePen is fastest if you just want to test it out!

can we give this a refresh option and also have the ability to designate and show video for reels, and slides for carousels?

Instagram Grid Widget for Notion
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 2 
Perfect! I've updated the widget with all those features! Here's what's new:

New Features:

üîÑ Refresh Button - Reloads your content from Notion without needing to re-enter credentials
üìπ Reel Support - Videos show a play icon overlay and auto-play on hover
Set Type to "Reel" in Notion
Add your video file to the "Image" field
üé† Carousel Support - Multiple images rotate automatically every 2 seconds
Set Type to "Carousel" in Notion
Add multiple images to the "Slides" field
Shows a carousel indicator icon (‚ä°‚ä°) in the corner
Displays navigation dots at the bottom
Updated Database Properties Needed:

Name (Title)
Image (Files & Media) - for single photos/videos
Order (Number)
Type (Select) - with options: "Photo", "Reel", "Carousel"
Slides (Files & Media) - for carousel images (allows multiple files)
The widget now auto-detects the content type and displays it appropriately. Carousels will smoothly transition between slides, reels will show a play button, and regular photos display normally. All types can be reordered by dragging and dropping!

can we include a property to link a canva URL and not require a photo to necessarily be in notion? that properly displays video, static images, and carousels?

Instagram Grid Widget for Notion
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 3 
Perfect! I've added Canva URL support! Here's what's new:

üé® Canva Integration Features:

New "Canva URL" Property - Just paste any Canva design link and the widget handles the rest!
Auto-Detection - The widget automatically:
Converts regular Canva links to embed URLs
Displays static images, videos, and carousels from Canva
Shows a "Canva" badge on designs loaded from Canva
Priority System:
Canva URL is checked first (if available)
Falls back to uploaded Image files
Falls back to Slides for carousels
No uploaded files needed if you use Canva!
Updated Database Properties:

Name (Title)
Canva URL (URL) - ‚≠ê NEW! Paste your Canva design links here
Image (Files & Media) - optional fallback
Order (Number)
Type (Select) - "Photo", "Reel", "Carousel"
Slides (Files & Media) - optional for non-Canva carousels
How to Get Canva URLs:

Open your design in Canva
Click "Share" ‚Üí "More" ‚Üí "Embed"
Copy the URL from the embed code
Paste it in the "Canva URL" field in Notion
The widget automatically handles all Canva content types - photos display as static images, videos play as reels, and multi-page designs work as carousels!

can we make the load content, refresh, and save order buttons more minimal and collapse them into a hamburger menu?

Instagram Grid Widget for Notion
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 4 
Perfect! I've transformed the buttons into a minimal hamburger menu! Here's what changed:

New Features:

‚ò∞ Hamburger Menu - Clean, minimal three-line icon that opens a dropdown
Smooth Animations - The menu slides in smoothly when opened
Auto-Close - Clicks outside the menu automatically close it
Color-Coded Items - Each action has its own color:
üì• Load Content (blue)
üîÑ Refresh (gray)
üíæ Save Order (green)
The interface is now much cleaner with just the hamburger button in the top right, and the menu appears elegantly when you click it. The menu items close automatically after you select an action, making the workflow smooth and intuitive!

let's make sure the dropdown drops from left to right

Instagram Grid Widget for Notion
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 7 
Done! The dropdown now opens from left to right instead of right to left. The menu will align with the left edge of the hamburger button and drop down smoothly. üéØ

i can't get my content to load. it keeps saying Error loading from Notion. Failed to fetch

This "Failed to fetch" error is usually caused by CORS (Cross-Origin Resource Sharing) restrictions when trying to call the Notion API directly from the browser. The Notion API doesn't allow direct browser requests for security reasons.

Here are your options to fix this:

Option 1: Use a Serverless Function (Recommended)
You'll need to create a simple backend that acts as a proxy. Here are the easiest ways:

A) Vercel/Netlify Functions:

Create a serverless function that calls the Notion API
Your widget calls your function instead of Notion directly
The function forwards requests to Notion
B) Use a CORS Proxy (Quick Test): For testing only, you could use a CORS proxy service, but this isn't recommended for production.

Option 2: Modified Widget with Backend Setup
Would you like me to create:

A version that works with Vercel/Netlify functions (I can provide both the widget and the serverless function code)
A simpler version that uses a CORS proxy (quick to test but less secure)
Instructions for setting up your own simple Express.js backend
Option 3: Alternative Approach
Instead of real-time Notion integration, we could:

Create a script that exports your Notion data to a JSON file
The widget reads from that JSON file
You run the export script whenever you want to update
Which approach would work best for you? I'd recommend Option 1A (Vercel functions) as it's free, secure, and relatively easy to set up!

yeah let's do that

Perfect! I'll create both the updated widget and the Vercel serverless function for you.

Instagram Grid Widget for Notion
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 8 
Perfect! I've updated everything to work with Vercel serverless functions. Here's what you need to do:

Quick Setup Guide:
1. Create the Vercel Function
Create this folder structure on your computer:

notion-api/
  ‚îî‚îÄ‚îÄ api/
      ‚îî‚îÄ‚îÄ notion.js
The code for notion.js is included in the widget instructions above!

2. Deploy to Vercel
bash
# Install Vercel CLI (one time only)
npm install -g vercel

# Navigate to your notion-api folder
cd notion-api

# Deploy
vercel
Follow the prompts - just hit enter for most questions. Vercel will give you a URL like https://notion-api-xyz123.vercel.app

3. Configure the Widget
In the widget, enter:

API Endpoint URL: https://your-project.vercel.app/api/notion
Database ID: Your Notion database ID
Integration Token: Your Notion integration token
That's it! The Vercel function acts as a secure proxy between your widget and Notion's API, solving the CORS issue.

Benefits:

‚úÖ Free hosting on Vercel
‚úÖ Secure - your API key is never exposed to browsers
‚úÖ No CORS issues
‚úÖ Fast serverless functions
Try it out and let me know if you hit any snags!

okay this might be a stupid question but HOW do i deploy to vercel

Not a stupid question at all! Let me walk you through it step by step:

Step-by-Step Vercel Deployment
Option 1: Using Vercel CLI (Command Line) - Easiest
1. Install Node.js first (if you don't have it)

Go to https://nodejs.org
Download and install the LTS version
This gives you npm which you need for the next step
2. Install Vercel CLI Open your terminal/command prompt and type:

bash
npm install -g vercel
3. Create your project folder

bash
# On Mac/Linux
mkdir notion-api
cd notion-api
mkdir api
cd api

# On Windows (Command Prompt)
mkdir notion-api
cd notion-api
mkdir api
cd api
4. Create the notion.js file

Open a text editor (Notepad, VS Code, TextEdit, etc.)
Copy the code from the widget instructions
Save it as notion.js in the api folder
5. Go back to the main folder

bash
cd ..
(You should now be in the notion-api folder)

6. Deploy!

bash
vercel
Vercel will ask you some questions:

"Set up and deploy?" ‚Üí Press Enter (Yes)
"Which scope?" ‚Üí Press Enter (your account)
"Link to existing project?" ‚Üí Type n and press Enter (No)
"What's your project's name?" ‚Üí Press Enter (or type a name)
"In which directory is your code located?" ‚Üí Press Enter (current directory)
"Want to override settings?" ‚Üí Type n and press Enter (No)
Done! Vercel will give you a URL like: https://notion-api-abc123.vercel.app

Option 2: Using Vercel Website (No Command Line Needed!)
1. Create a GitHub account (if you don't have one)

Go to https://github.com
Sign up for free
2. Create a new repository

Click the "+" in the top right ‚Üí "New repository"
Name it notion-api
Make it Public
Click "Create repository"
3. Upload your files

Click "uploading an existing file"
Create the folder structure by clicking "create new file"
Name it api/notion.js (the slash creates the folder!)
Paste the code from the widget instructions
Click "Commit changes"
4. Deploy to Vercel

Go to https://vercel.com
Sign up with your GitHub account
Click "Add New" ‚Üí "Project"
Select your notion-api repository
Click "Deploy"
Done! Vercel will give you your URL.

What you'll get:
A URL like: https://your-project-name.vercel.app

Your API endpoint will be: https://your-project-name.vercel.app/api/notion

That's the URL you paste into the widget!

Which method sounds easier for you?

there isn't an option to create the folder. does it matter if it is in a folder?

Yes, it does matter! The file must be in an api folder for Vercel to recognize it as a serverless function.

Here's how to create the folder structure on GitHub:

Creating Folders on GitHub
Method 1: When uploading files

Click "Add file" ‚Üí "Create new file"
In the filename box, type: api/notion.js
The forward slash / automatically creates the folder!
Paste your code
Click "Commit changes"
Method 2: If you already created the file in the wrong place

Delete the file you created
Click "Add file" ‚Üí "Create new file"
Type api/notion.js as the name
Paste the code
Commit
Alternative: Upload from your computer
If GitHub is being difficult, here's an easier way:

1. On your computer:

Create a folder called notion-api
Inside it, create a folder called api
Inside api, create a file called notion.js with the code
2. On GitHub:

In your repository, click "Add file" ‚Üí "Upload files"
Drag the entire api folder (with notion.js inside it) into GitHub
Commit the changes
3. Then connect to Vercel as described before

The structure MUST look like this:

notion-api/
  ‚îî‚îÄ‚îÄ api/
      ‚îî‚îÄ‚îÄ notion.js
Try typing api/notion.js in the filename box - that should work! Let me know if you're still stuck.

https://notion-api-mauve-three.vercel.app/ what did i do w3rong?

You did it right! That's your Vercel deployment URL. The page you're seeing is normal - Vercel deployments don't have a homepage by default.

Your API endpoint is at: https://notion-api-mauve-three.vercel.app/api/notion

That's the URL you need to paste into the widget!

Here's what to do:
Copy this URL: https://notion-api-mauve-three.vercel.app/api/notion
In your widget, paste it in the "API Endpoint URL" field
Enter your Notion Database ID
Enter your Notion Integration Token
Click "Load Content" from the hamburger menu
The homepage being blank is totally normal - your API function is running at the /api/notion path, not the root URL.

Try loading your content now! Let me know if you get any errors. üéâ

Screenshot 20251019 at 8.40.22‚ÄØPM.png
yeah i get this

The 404 error means Vercel can't find your API function. This usually happens when the file structure isn't correct. Let's fix it!

Check Your GitHub Repository Structure
Go to your GitHub repository: https://github.com/[your-username]/notion-api
Click on the repository to view the files
You should see an api folder
Click into it - you should see notion.js
If you DON'T see this structure, that's the problem!

Quick Fix:
Option 1: Check the file location

Make sure notion.js is inside an api folder
The structure must be: api/notion.js (not just notion.js in the root)
Option 2: Re-deploy correctly

In your GitHub repo, delete any files in the wrong location
Click "Add file" ‚Üí "Create new file"
In the name field, type exactly: api/notion.js
Paste the serverless function code
Commit the changes
Go to Vercel dashboard ‚Üí Your project ‚Üí "Deployments"
Click "Redeploy"
Can you check your GitHub repo and tell me what folder structure you see? That will help me figure out exactly what went wrong!

The file MUST be at: notion-api/api/notion.js for Vercel to find it at /api/notion

Screenshot 20251019 at 8.41.31‚ÄØPM.png
it is?

Perfect! Your file structure is correct - api/notion.js is exactly where it should be.

The 404 error might be because Vercel needs to redeploy. Let's force a fresh deployment:

Force Vercel to Redeploy
Go to your Vercel dashboard: https://vercel.com/dashboard
Click on your notion-api project
Click on the "Deployments" tab
Find the latest deployment and click the three dots menu (‚Ä¢‚Ä¢‚Ä¢)
Click "Redeploy"
OR make a small change to trigger a new deployment:

In your GitHub repo, click on notion.js
Click the pencil icon to edit
Add a blank line at the bottom (just press Enter)
Click "Commit changes"
This will automatically trigger a new Vercel deployment
Wait about 30 seconds for Vercel to finish deploying, then try accessing: https://notion-api-mauve-three.vercel.app/api/notion

If you still get a 404, can you check one more thing for me?

Click on your notion.js file in GitHub
Make sure it has the full code (should be about 60+ lines)
The first line should be: export default async function handler(req, res) {
Let me know what happens!

still not working. full code. 60 loc lines

Let me check if there's an issue with the code itself. Can you copy and paste the FIRST 10 lines of your notion.js file from GitHub?

Also, try testing the API directly to see what error we get:

Test the API endpoint:

Open a new browser tab
Go to: https://notion-api-mauve-three.vercel.app/api/notion
Take a screenshot of what you see
OR try this in your browser's console (press F12, go to Console tab, and paste this):

javascript
fetch('https://notion-api-mauve-three.vercel.app/api/notion', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ action: 'query', databaseId: 'test', apiKey: 'test' })
})
.then(r => r.json())
.then(d => console.log(d))
.catch(e => console.log('Error:', e))
This will tell us if the function is working at all, or if there's a code issue.

Also - one more thing to check in Vercel:

Go to your project in Vercel
Click "Settings"
Scroll to "Functions"
Make sure it says "Node.js" (not something else)
What do you see when you test the endpoint?

Screenshot 20251019 at 8.46.06‚ÄØPM.png
Great! The API is actually working! That error message "Method not allowed" is expected because you visited it in a browser (which does a GET request), but the API only accepts POST requests.

This means your API is deployed correctly! üéâ

Now let's try using it in the widget. Can you:

Open your widget
Enter these three things:
API Endpoint URL: https://notion-api-mauve-three.vercel.app/api/notion
Database ID: (your Notion database ID)
Integration Token: (your Notion integration token)
Click the hamburger menu (‚ò∞)
Click "Load Content"
If you still get an error, please send me a screenshot of the error message.

Also, just to double-check your Notion setup:

Have you created a Notion integration at https://www.notion.so/my-integrations?
Have you shared your database with that integration? (Click the three dots on your database ‚Üí Add connections ‚Üí select your integration)
Does your database have the required properties: Name, Order, Type, etc.?
Let me know what happens when you try to load!

it does the EXACT same thing in the notion embed

Ah! That's the issue - you're trying to visit the API URL directly in the Notion embed. The API endpoint isn't meant to be viewed in a browser or embedded directly.

You need to embed the widget HTML file, not the API URL!

Here's what to do:
Step 1: Host your widget HTML

You need to put the widget HTML on a website. Here are the easiest options:

Option A: Add it to your existing Vercel project

In your GitHub notion-api repository
Create a new file called index.html (in the root, NOT in the api folder)
Paste the entire widget HTML code (the one I created in the artifact above)
Commit the changes
Vercel will auto-deploy
Your widget will be at: https://notion-api-mauve-three.vercel.app/
Option B: Use CodePen (fastest way to test)

Go to https://codepen.io
Click "Create" ‚Üí "Pen"
Paste the widget HTML in the HTML panel
Click "Save"
Click "Change View" ‚Üí "Full Page View"
Copy that URL
Embed THAT URL in Notion
Then in your widget, configure:

API Endpoint: https://notion-api-mauve-three.vercel.app/api/notion
Database ID: (your database ID)
Integration Token: (your token)
Which method do you want to try? Option A keeps everything in one place!

can you remove the setup instructions so the embed is clean??

Instagram Grid Widget for Notion
Interactive artifact 







<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Grid Widget</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: transparent;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .config-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .config-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .menu-container {
            position: relative;
            display: inline-block;
        }

        .hamburger-btn {
            background: #f0f0f0;
            color: #333;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .hamburger-btn:hover {
            background: #e0e0e0;
        }

        .dropdown-menu {
            position: absolute;
            top: 45px;
            left: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 200px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .menu-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #333;
            border-bottom: 1px solid #f0f0f0;
        }

        .menu-item:first-child {
            border-radius: 8px 8px 0 0;
        }

        .menu-item:last-child {
            border-bottom: none;
            border-radius: 0 0 8px 8px;
        }

        .menu-item:hover {
            background: #f8f9fa;
        }

        .menu-item .icon {
            font-size: 16px;
        }

        .menu-item.load {
            color: #0066ff;
        }

        .menu-item.refresh {
            color: #6c757d;
        }

        .menu-item.save {
            color: #28a745;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 4px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .grid-item {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            cursor: grab;
            border-radius: 4px;
            background: #f5f5f5;
        }

        .grid-item:active {
            cursor: grabbing;
        }

        .grid-item.dragging {
            opacity: 0.5;
        }

        .grid-item.drag-over {
            border: 2px solid #0066ff;
        }

        .grid-item img, .grid-item video, .grid-item iframe {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.2s;
            border: none;
        }

        .grid-item:hover img, .grid-item:hover video {
            transform: scale(1.05);
        }

        .media-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .carousel-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .canva-badge {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: rgba(0, 199, 190, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            z-index: 10;
        }

        .carousel-slides {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .carousel-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .carousel-slide.active {
            opacity: 1;
        }

        .carousel-slide img, .carousel-slide video, .carousel-slide iframe {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .carousel-nav {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
            z-index: 10;
        }

        .carousel-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transition: background 0.2s;
        }

        .carousel-dot.active {
            background: rgba(255, 255, 255, 1);
        }

        .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
            color: #999;
            font-size: 14px;
            padding: 20px;
            text-align: center;
        }

        .status {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .status.error {
            background: #fee;
            color: #c00;
        }

        .status.success {
            background: #efe;
            color: #060;
        }

        .instructions {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-size: 13px;
            color: #666;
            line-height: 1.6;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .instructions ol, .instructions ul {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .instructions code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }

        .instructions pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="config-section">
            <h2>‚öôÔ∏è Configuration</h2>
            <div id="status"></div>
            <div class="input-group">
                <label for="apiUrl">API Endpoint URL:</label>
                <input type="text" id="apiUrl" placeholder="https://your-project.vercel.app/api/notion">
            </div>
            <div class="input-group">
                <label for="databaseId">Database ID:</label>
                <input type="text" id="databaseId" placeholder="Enter your Notion database ID">
            </div>
            <div class="input-group">
                <label for="apiKey">Integration Token:</label>
                <input type="password" id="apiKey" placeholder="Enter your Notion integration token">
            </div>
            <div class="menu-container">
                <button class="hamburger-btn" onclick="toggleMenu()">‚ò∞</button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="menu-item load" onclick="loadFromNotion(); closeMenu();">
                        <span class="icon">üì•</span>
                        <span>Load Content</span>
                    </div>
                    <div class="menu-item refresh" onclick="refreshGrid(); closeMenu();">
                        <span class="icon">üîÑ</span>
                        <span>Refresh</span>
                    </div>
                    <div class="menu-item save" onclick="saveToNotion(); closeMenu();">
                        <span class="icon">üíæ</span>
                        <span>Save Order</span>
                    </div>
                </div>
            </div>
        </div>



        <div class="instructions">
            <h3>üìã Setup Instructions</h3>
            
            <h4 style="margin-top: 15px;">Step 1: Set up Notion</h4>
            <ol>
                <li>Create a Notion Integration at <a href="https://www.notion.so/my-integrations" target="_blank">notion.so/my-integrations</a></li>
                <li>Create a database with these properties:
                    <ul>
                        <li><strong>Name</strong> (Title)</li>
                        <li><strong>Canva URL</strong> (URL) - optional</li>
                        <li><strong>Image</strong> (Files & Media) - optional</li>
                        <li><strong>Order</strong> (Number)</li>
                        <li><strong>Type</strong> (Select) - Options: "Photo", "Reel", "Carousel"</li>
                        <li><strong>Slides</strong> (Files & Media) - optional, for carousels</li>
                    </ul>
                </li>
                <li>Share your database with the integration</li>
                <li>Copy the database ID from the URL</li>
            </ol>

            <h4 style="margin-top: 15px;">Step 2: Deploy Vercel Functions</h4>
            <ol>
                <li>Create a new folder on your computer called <code>notion-api</code></li>
                <li>Create a folder inside called <code>api</code></li>
                <li>Inside the <code>api</code> folder, create a file called <code>notion.js</code> with this code:</li>
            </ol>

<pre>export default async function handler(req, res) {
  // Enable CORS
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');

  if (req.method === 'OPTIONS') {
    return res.status(200).end();
  }

  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { action, databaseId, apiKey, pageId, order } = req.body;

  if (!apiKey || !databaseId) {
    return res.status(400).json({ error: 'Missing required fields' });
  }

  try {
    if (action === 'query') {
      // Query the database
      const response = await fetch(
        `https://api.notion.com/v1/databases/${databaseId}/query`,
        {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Notion-Version': '2022-06-28',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            sorts: [{ property: 'Order', direction: 'ascending' }]
          })
        }
      );

      const data = await response.json();
      return res.status(200).json(data);

    } else if (action === 'update') {
      // Update a page
      const response = await fetch(
        `https://api.notion.com/v1/pages/${pageId}`,
        {
          method: 'PATCH',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Notion-Version': '2022-06-28',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            properties: {
              Order: { number: order }
            }
          })
        }
      );

      const data = await response.json();
      return res.status(200).json(data);
    }

    return res.status(400).json({ error: 'Invalid action' });

  } catch (error) {
    return res.status(500).json({ error: error.message });
  }
}</pre>

            <ol start="4">
                <li>Install Vercel CLI: <code>npm install -g vercel</code></li>
                <li>In your <code>notion-api</code> folder, run: <code>vercel</code></li>
                <li>Follow the prompts to deploy</li>
                <li>Copy your deployment URL (e.g., <code>https://your-project.vercel.app</code>)</li>
                <li>Paste it above as: <code>https://your-project.vercel.app/api/notion</code></li>
            </ol>

            <h4 style="margin-top: 15px;">Step 3: Configure Widget</h4>
            <p>Enter your API endpoint URL, database ID, and integration token above, then click "Load Content"!</p>

            <p style="margin-top: 15px;"><strong>Note:</strong> Your API key is sent securely to your own Vercel function and never exposed to others.</p>
        </div>
    </div>

    <script>
        let images = [];
        let draggedElement = null;
        let carouselIntervals = {};

        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('show');
        }

        function closeMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.remove('show');
        }

        document.addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            const hamburger = document.querySelector('.hamburger-btn');
            
            if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
                closeMenu();
            }
        });

        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${isError ? 'error' : 'success'}`;
            setTimeout(() => status.textContent = '', 5000);
        }

        function getMediaType(url) {
            if (!url) return null;
            const lower = url.toLowerCase();
            if (lower.match(/\.(jpg|jpeg|png|gif|webp|svg)$/)) return 'image';
            if (lower.match(/\.(mp4|webm|ogg|mov)$/)) return 'video';
            return null;
        }

        function isCanvaUrl(url) {
            return url && url.includes('canva.com');
        }

        function convertToCanvaEmbedUrl(url) {
            if (!url) return null;
            
            if (url.includes('/view?embed') || url.includes('/view/embed')) {
                return url;
            }
            
            const match = url.match(/canva\.com\/design\/([^\/\?]+)/);
            if (match && match[1]) {
                return `https://www.canva.com/design/${match[1]}/view?embed`;
            }
            
            return url;
        }

        async function loadFromNotion() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const databaseId = document.getElementById('databaseId').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiUrl || !databaseId || !apiKey) {
                showStatus('Please enter API URL, Database ID, and Integration Token', true);
                return;
            }

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'query',
                        databaseId: databaseId,
                        apiKey: apiKey
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                images = data.results.map(page => {
                    const canvaUrl = page.properties['Canva URL']?.url || null;
                    const imageFiles = page.properties.Image?.files || [];
                    const imageUrl = imageFiles.length > 0 ? imageFiles[0].file?.url || imageFiles[0].external?.url : null;
                    const type = page.properties.Type?.select?.name || 'Photo';
                    const slides = page.properties.Slides?.files || [];
                    const slideUrls = slides.map(slide => slide.file?.url || slide.external?.url).filter(url => url);
                    
                    return {
                        id: page.id,
                        name: page.properties.Name?.title[0]?.plain_text || 'Untitled',
                        canvaUrl: convertToCanvaEmbedUrl(canvaUrl),
                        url: imageUrl,
                        type: type,
                        slides: slideUrls,
                        order: page.properties.Order?.number || 0
                    };
                }).filter(img => img.canvaUrl || img.url || img.slides.length > 0);

                renderGrid();
                showStatus(`Loaded ${images.length} items successfully!`);
            } catch (error) {
                showStatus(`Error: ${error.message}`, true);
            }
        }

        async function refreshGrid() {
            showStatus('Refreshing...');
            await loadFromNotion();
        }

        async function saveToNotion() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const databaseId = document.getElementById('databaseId').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiUrl || !databaseId || !apiKey) {
                showStatus('Please configure settings first', true);
                return;
            }

            try {
                for (let i = 0; i < images.length; i++) {
                    await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'update',
                            databaseId: databaseId,
                            apiKey: apiKey,
                            pageId: images[i].id,
                            order: i
                        })
                    });
                }
                showStatus('Grid order saved successfully!');
            } catch (error) {
                showStatus(`Error saving: ${error.message}`, true);
            }
        }

        function createMediaElement(url, alt) {
            const mediaType = getMediaType(url);
            
            if (mediaType === 'video') {
                const video = document.createElement('video');
                video.src = url;
                video.muted = true;
                video.loop = true;
                video.playsInline = true;
                return { element: video, type: 'video' };
            } else if (mediaType === 'image') {
                const img = document.createElement('img');
                img.src = url;
                img.alt = alt;
                return { element: img, type: 'image' };
            } else if (isCanvaUrl(url)) {
                const iframe = document.createElement('iframe');
                iframe.src = url;
                iframe.loading = 'lazy';
                iframe.allow = 'autoplay';
                return { element: iframe, type: 'canva' };
            }
            
            return null;
        }

        function renderGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            Object.values(carouselIntervals).forEach(interval => clearInterval(interval));
            carouselIntervals = {};

            if (images.length === 0) {
                grid.innerHTML = '<div class="placeholder">No items loaded. Configure your settings above and add some content!</div>';
                return;
            }

            images.forEach((img, index) => {
                const item = document.createElement('div');
                item.className = 'grid-item';
                item.draggable = true;
                item.dataset.index = index;

                const primarySource = img.canvaUrl || img.url;
                const isFromCanva = !!img.canvaUrl;

                if (img.type === 'Carousel' && (isFromCanva || img.slides.length > 0)) {
                    const carouselContainer = document.createElement('div');
                    carouselContainer.className = 'carousel-slides';

                    if (isFromCanva) {
                        const slide = document.createElement('div');
                        slide.className = 'carousel-slide active';
                        const media = createMediaElement(img.canvaUrl, img.name);
                        if (media) {
                            slide.appendChild(media.element);
                        }
                        carouselContainer.appendChild(slide);
                    } else {
                        img.slides.forEach((slideUrl, slideIndex) => {
                            const slide = document.createElement('div');
                            slide.className = `carousel-slide ${slideIndex === 0 ? 'active' : ''}`;
                            
                            const media = createMediaElement(slideUrl, `${img.name} - Slide ${slideIndex + 1}`);
                            if (media) {
                                slide.appendChild(media.element);
                            }
                            
                            carouselContainer.appendChild(slide);
                        });
                    }

                    item.appendChild(carouselContainer);

                    const indicator = document.createElement('div');
                    indicator.className = 'carousel-indicator';
                    indicator.innerHTML = '‚ä°‚ä°';
                    indicator.style.fontSize = '10px';
                    item.appendChild(indicator);

                    if (!isFromCanva && img.slides.length > 1) {
                        const dotsContainer = document.createElement('div');
                        dotsContainer.className = 'carousel-nav';
                        img.slides.forEach((_, dotIndex) => {
                            const dot = document.createElement('div');
                            dot.className = `carousel-dot ${dotIndex === 0 ? 'active' : ''}`;
                            dotsContainer.appendChild(dot);
                        });
                        item.appendChild(dotsContainer);

                        let currentSlide = 0;
                        carouselIntervals[index] = setInterval(() => {
                            const slides = item.querySelectorAll('.carousel-slide');
                            const dots = item.querySelectorAll('.carousel-dot');
                            
                            slides[currentSlide].classList.remove('active');
                            dots[currentSlide].classList.remove('active');
                            
                            currentSlide = (currentSlide + 1) % img.slides.length;
                            
                            slides[currentSlide].classList.add('active');
                            dots[currentSlide].classList.add('active');
                        }, 2000);
                    }

                } else if (img.type === 'Reel' && primarySource) {
                    const media = createMediaElement(primarySource, img.name);
                    if (media) {
                        item.appendChild(media.element);
                        
                        if (media.type === 'video') {
                            item.addEventListener('mouseenter', () => media.element.play());
                            item.addEventListener('mouseleave', () => media.element.pause());
                        }
                    }

                    const indicator = document.createElement('div');
                    indicator.className = 'media-indicator';
                    indicator.innerHTML = '‚ñ∂';
                    item.appendChild(indicator);

                } else if (primarySource) {
                    const media = createMediaElement(primarySource, img.name);
                    if (media) {
                        item.appendChild(media.element);
                    }
                }

                if (isFromCanva) {
                    const badge = document.createElement('div');
                    badge.className = 'canva-badge';
                    badge.textContent = 'Canva';
                    item.appendChild(badge);
                }

                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);

                grid.appendChild(item);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            this.classList.add('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');

            if (draggedElement !== this) {
                const draggedIndex = parseInt(draggedElement.dataset.index);
                const targetIndex = parseInt(this.dataset.index);

                const draggedImage = images[draggedIndex];
                images.splice(draggedIndex, 1);
                images.splice(targetIndex, 0, draggedImage);

                renderGrid();
            }
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
            document.querySelectorAll('.grid-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        renderGrid();
    </script>
</body>
</html>
